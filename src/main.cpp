#include <iostream>
#include <cstdlib>
#include <ctime>
using namespace std;

// Задача 1 ############################################################################################################################
void task_1(){ // Главная функция первой задачи
    char passw[33] {};

    int passw_length = 0;
    int f_number = 0;
    int f_ABC = 0;
    int f_abc = 0;
    int f_symbol = 0;
    int amount_passw = 0;

    while(true){
        cout << "Введите требуемую длинну пароля(от 6 до 32 символов): ";
        cin >> passw_length;
        if (cin.fail()) { // введение символов другого типа, не равного типу переменно
            cin.clear(); // Если происходит ошибка ввода, другие операции ставятся на паузу => необходимо сбросить флаг ошибки
            cin.ignore(10000, '\n'); // Удаление из буфера входных данных
            cout << "Ошибка ввода. Попробуйте снова.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }
        cin.ignore(10000, '\n');
        if (passw_length < 6 || passw_length > 32) { // Проверяю соответствие длинны
            cout << "Длина должна быть от 6 до 32 символов.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }

        cout << "Включить цифры в пароль(0 - нет, 1 - да): ";
        cin >> f_number;
        if (cin.fail() || (f_number != 0 && f_number != 1)) { // введение символов другого типа, не равного типу переменно
            cin.clear(); // Если происходит ошибка ввода, другие операции ставятся на паузу => необходимо сбросить флаг ошибки
            cin.ignore(10000, '\n'); // Удаление из буфера входных данных
            cout << "Ошибка ввода. Попробуйте снова. Введите 0 или 1.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }
        cin.ignore(10000, '\n');

        cout << "Включить прописные буквы в пароль(0 - нет, 1 - да): ";
        cin >> f_ABC;
        if (cin.fail() || (f_ABC != 0 && f_ABC != 1)) { // введение символов другого типа, не равного типу переменно
            cin.clear(); // Если происходит ошибка ввода, другие операции ставятся на паузу => необходимо сбросить флаг ошибки
            cin.ignore(10000, '\n'); // Удаление из буфера входных данных
            cout << "Ошибка ввода. Попробуйте снова. Введите 0 или 1.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }
        cin.ignore(10000, '\n');

        cout << "Включить строчные буквы в пароль(0 - нет, 1 - да): ";
        cin >> f_abc;
        if (cin.fail() || (f_abc != 0 && f_abc != 1)) { // введение символов другого типа, не равного типу переменно
            cin.clear(); // Если происходит ошибка ввода, другие операции ставятся на паузу => необходимо сбросить флаг ошибки
            cin.ignore(10000, '\n'); // Удаление из буфера входных данных
            cout << "Ошибка ввода. Попробуйте снова. Введите 0 или 1.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }
        cin.ignore(10000, '\n');

        cout << "Включить спецсимволы в пароль(0 - нет, 1 - да): ";
        cin >> f_symbol;
        if (cin.fail() || (f_symbol != 0 && f_symbol != 1)) { // введение символов другого типа, не равного типу переменно
            cin.clear(); // Если происходит ошибка ввода, другие операции ставятся на паузу => необходимо сбросить флаг ошибки
            cin.ignore(10000, '\n'); // Удаление из буфера входных данных
            cout << "Ошибка ввода. Попробуйте снова. Введите 0 или 1.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }
        cin.ignore(10000, '\n');

        if (!f_number && !f_ABC && !f_abc && !f_symbol) { // Проверка ввёл ли пользователь хотя бы один тип флагов
            cout << "Выберите хотя бы один тип символов!\n" << endl;
            continue;
        }

        cout << "Введите количество паролей для генерации: ";
        cin >> amount_passw;
        if (cin.fail()) { // введение символов другого типа, не равного типу переменно
            cin.clear(); // Если происходит ошибка ввода, другие операции ставятся на паузу => необходимо сбросить флаг ошибки
            cin.ignore(10000, '\n'); // Удаление из буфера входных данных
            cout << "Ошибка ввода. Попробуйте снова.\n" << endl;
            continue; // возвращает к началу, чтобы снова запросить ввод
        }
        cin.ignore(10000, '\n');
        if (cin.peek() != '\n') { // Смотрит следующий символ в буфере обмена
            cin.ignore(10000, '\n');
            cout << "Ошибка: лишние символы после числа\n";
            continue;
        }

        break;
    }

    // Составляю список разрешённых символов
    char spec[] = "!@#$%^&*_?";
    char symbols[100];
    int sym_count = 0;

    if (f_number == true){
        for (char c = '0'; c <= '9'; c++) {
            symbols[sym_count++] = c;
        }
    }
    if (f_ABC == true){
        for (char c = 'A'; c <= 'Z'; c++) {
            symbols[sym_count++] = c;
        }
    }
    if (f_abc == true){
        for (char c = 'a'; c <= 'z'; c++) {
            symbols[sym_count++] = c;
        }
    }
    if (f_symbol == true){
        for (int i = 0; spec[i] != '\0'; i++) {
            symbols[sym_count++] = spec[i];
        }
    }

    // Генерация паролей
    for (int k = 0; k < amount_passw; k++) {
        for (int i = 0; i < passw_length; i++) {
            int index = rand() % sym_count;
            passw[i] = symbols[index];
        }
        passw[passw_length] = '\0';
        cout << "Пароль " << k+1 << ": " << passw << endl;

        // Оценка надёжности сгенерированного пароля
        int score = 0;
        if (passw_length >= 12)
            score += 2;
        else if (passw_length >= 8)
            score += 1;
        if (f_number) score++;
        if (f_ABC) score++;
        if (f_abc) score++;
        if (f_symbol) score++;
        cout << "Оценка надежности: ";
        if (score <= 2)
            cout << "Слабый";
        else if (score <= 4)
            cout << "Средний";
        else
            cout << "Сильный";
        cout << endl;
    }
}
int main() {
    srand(time(0)); // необходимо для правильной генерации паролей(чтобы пароли не были одинаковыми)

    void task_1();
    return 0;
}